<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="DENY" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />

  <title>Obrigado - Compra Confirmada</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
    rel="stylesheet"
    media="print"
    onload="this.media='all'"
  />
  <noscript>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </noscript>

  <!-- UTM Capture Script -->
  <script>
    (function () {
      const urlParams = new URLSearchParams(window.location.search);
      const utmKeys = ['utm_source','utm_medium','utm_campaign','utm_content','utm_term','src','sck'];
      const utmParams = {};
      const utmData = {};
      let hasUtms = false;

      utmKeys.forEach(key => {
        const value = urlParams.get(key);
        if (value) {
          const sanitized = String(value).replace(/[<>\"']/g, '').substring(0, 200);
          if (sanitized) {
            utmParams[key] = sanitized;
            utmData[key] = sanitized;
            hasUtms = true;
          } else {
            utmParams[key] = null;
          }
        } else {
          utmParams[key] = null;
        }
      });

      if (hasUtms) {
        localStorage.setItem('utmParams', JSON.stringify(utmParams));
        utmData.createdAt = new Date().getTime();
        localStorage.setItem('utm_data', JSON.stringify(utmData));
      }
    })();
  </script>

  <style>
    :root {
      --cor-primaria: #0b5cab;
      --cor-primaria-escura: #084a8c;
      --cor-secundaria: #f39200;
      --cor-sucesso: #2e7d32;
      --cor-sucesso-clara: #4CAF50;
      --cor-sucesso-fundo: #e8f5e9;
      --cor-texto: #212529;
      --cor-texto-secundario: #6c757d;
      --cor-fundo: #f8f9fa;
      --cor-branco: #ffffff;

      --espaco-xs: 5px;
      --espaco-sm: 10px;
      --espaco-md: 15px;
      --espaco-lg: 20px;
      --espaco-xl: 25px;
      --espaco-2xl: 30px;
      --espaco-3xl: 35px;
      --espaco-4xl: 40px;

      --raio-sm: 10px;
      --raio-md: 12px;

      --sombra-sm: 0 2px 8px rgba(0,0,0,0.04);
      --sombra-md: 0 4px 12px rgba(0,0,0,0.08);
      --sombra-lg: 0 4px 20px rgba(0,0,0,0.08);

      --cor-urgente: #dc3545;
      --cor-destaque: #ff6b35;
    }

    *{margin:0;padding:0;box-sizing:border-box}

    body{
      font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
      background-color:var(--cor-fundo);
      margin:0;
      min-height:100vh;
      padding-top:110px;
      padding-bottom:var(--espaco-4xl);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.5
    }

    .container{
      max-width:680px;
      width:100%;
      background-color:var(--cor-branco);
      border-radius:var(--raio-md);
      box-shadow:var(--sombra-lg);
      overflow:hidden;
      margin:0 auto
    }

    .header{
      background:linear-gradient(135deg,var(--cor-primaria) 0%,var(--cor-primaria-escura) 100%);
      padding:14px var(--espaco-lg);
      text-align:center;
      display:flex;
      align-items:center;
      justify-content:center;
      position:fixed;
      top:0;left:0;width:100%;height:110px;
      z-index:1000;
      box-shadow:var(--sombra-md)
    }

    .brand{
      width:100%;
      max-width:680px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      color:#fff;
    }
    .brand-badge{
      width:44px;height:44px;
      border-radius:12px;
      background:rgba(255,255,255,.18);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;
      box-shadow:0 8px 18px rgba(0,0,0,.12);
      user-select:none;
    }
    .brand-title{
      text-align:left;
      line-height:1.1;
    }
    .brand-title strong{
      display:block;
      font-size:16px;
      letter-spacing:.3px;
    }
    .brand-title span{
      display:block;
      font-size:12px;
      opacity:.9;
      margin-top:4px;
    }

    .main-section{padding:var(--espaco-4xl) var(--espaco-3xl)}

    .success-icon{
      width:100px;height:100px;margin:0 auto var(--espaco-2xl);
      background:linear-gradient(135deg,var(--cor-sucesso-clara) 0%,var(--cor-sucesso) 100%);
      border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 4px 20px rgba(76,175,80,0.3);
      animation:scaleIn .5s ease-out;will-change:transform
    }
    .success-icon::before{content:'‚úì';color:white;font-size:60px;font-weight:800;line-height:1}
    @keyframes scaleIn{0%{transform:scale(0);opacity:0}50%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}

    .titulo-principal{
      color:var(--cor-sucesso);
      font-size:30px;font-weight:800;margin:0 0 var(--espaco-md);
      text-align:center;letter-spacing:-.5px;line-height:1.2
    }
    .subtitulo{
      color:var(--cor-texto-secundario);
      font-size:16px;margin-bottom:var(--espaco-3xl);
      text-align:center;font-weight:500;line-height:1.5
    }

    .confirmacao-box{
      background:linear-gradient(135deg,var(--cor-sucesso-fundo) 0%,#c8e6c9 100%);
      border:2px solid var(--cor-sucesso-clara);
      border-radius:var(--raio-sm);
      padding:var(--espaco-2xl);
      margin:var(--espaco-2xl) 0;
      text-align:center;
      box-shadow:0 2px 12px rgba(76,175,80,.15)
    }
    .confirmacao-text{color:#1b5e20;font-weight:800;font-size:18px;margin-bottom:var(--espaco-sm)}
    .confirmacao-subtext{color:var(--cor-sucesso);font-size:14px;font-weight:700;margin-top:var(--espaco-sm)}

    .info-pedido{
      background-color:var(--cor-fundo);
      border-radius:var(--raio-sm);
      padding:var(--espaco-xl);
      margin:var(--espaco-xl) 0;
      box-shadow:var(--sombra-sm)
    }
    .info-pedido h3{color:var(--cor-primaria);font-size:18px;margin-bottom:var(--espaco-lg);font-weight:800}
    .info-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--espaco-md);padding:var(--espaco-sm) 0;border-bottom:1px solid #e9ecef}
    .info-row:last-child{margin-bottom:0;border-bottom:none}
    .info-row .label{color:var(--cor-texto-secundario);font-size:13px;font-weight:700}
    .info-row .value{color:var(--cor-texto);font-size:14px;font-weight:800}

    .mensagem-final{
      text-align:center;
      color:var(--cor-texto);
      font-size:15px;
      font-weight:700;
      margin:var(--espaco-xl) 0;
      line-height:1.6;
      padding:var(--espaco-xl);
      background-color:#fff3cd;
      border-left:4px solid var(--cor-secundaria);
      border-radius:var(--raio-sm)
    }

    .primary-button{
      background:linear-gradient(135deg,var(--cor-primaria) 0%,var(--cor-primaria-escura) 100%);
      color:#fff;border:none;
      padding:16px 22px;
      border-radius:14px;
      font-size:15px;font-weight:900;
      cursor:pointer;
      width:100%;
      box-shadow:0 10px 22px rgba(11,92,171,.25);
      transition:transform .2s ease, box-shadow .2s ease;
      text-transform:uppercase;
      letter-spacing:.4px
    }
    .primary-button:hover{transform:translateY(-2px);box-shadow:0 14px 28px rgba(11,92,171,.32)}
    .primary-button:active{transform:translateY(0)}
    .primary-button[disabled]{opacity:.65;cursor:not-allowed;transform:none;box-shadow:none}

    .help-link{text-align:center;margin-top:var(--espaco-md);padding-bottom:var(--espaco-sm)}
    .help-link a{color:var(--cor-primaria);text-decoration:underline;font-size:14px}

    /* Modal bol√£o */
    .bolao-modal-overlay{
      position:fixed;inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:18px;
    }
    .bolao-modal{
      width:100%;
      max-width:560px;
      background:#fff;
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 24px 60px rgba(0,0,0,.30);
      animation:modalIn .18s ease-out;
    }
    @keyframes modalIn{from{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}
    .bolao-modal-header{
      background:linear-gradient(135deg,var(--cor-primaria) 0%,var(--cor-primaria-escura) 100%);
      color:#fff;
      padding:16px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .bolao-modal-title{font-size:15px;font-weight:900;letter-spacing:.3px}
    .bolao-modal-close{
      border:none;background:rgba(255,255,255,.18);
      color:#fff;
      width:38px;height:38px;border-radius:10px;
      font-size:18px;font-weight:900;
      cursor:pointer;
      transition:background .15s ease;
    }
    .bolao-modal-close:hover{background:rgba(255,255,255,.26)}
    .bolao-modal-body{padding:18px}
    .bolao-meta{
      background:#f3f6fb;
      border:1px solid #e6eef8;
      border-radius:12px;
      padding:12px 14px;
      margin-bottom:14px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:space-between;
    }
    .bolao-meta strong{font-weight:900}
    .bolao-grid{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      padding:6px 0 4px;
    }
    .bolao-num{
      width:44px;height:44px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,var(--cor-primaria) 0%,var(--cor-primaria-escura) 100%);
      color:#fff;
      font-weight:900;
      box-shadow:0 6px 16px rgba(11,92,171,.28);
      user-select:none;
    }
    .bolao-empty{
      text-align:center;
      color:var(--cor-texto-secundario);
      font-weight:800;
      padding:10px 0 4px;
    }

    @media (max-width:600px){
      body{padding-top:105px;padding-bottom:var(--espaco-2xl)}
      .header{height:105px}
      .main-section{padding:var(--espaco-2xl) var(--espaco-lg)}
      .titulo-principal{font-size:26px}
      .subtitulo{font-size:15px}
      .info-row{flex-direction:column;align-items:flex-start;gap:var(--espaco-xs)}
    }
  </style>

  <!-- (Opcional) seu script UTMify existente, se voc√™ usa -->
  <script src="js/latest.js" defer></script>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="brand-badge">‚úì</div>
        <div class="brand-title">
          <strong>Compra confirmada</strong>
          <span>Painel de Bol√µes</span>
        </div>
      </div>
    </div>

    <div class="main-section">
      <div class="success-icon"></div>

      <h1 class="titulo-principal">OBRIGADO PELA SUA COMPRA!</h1>
      <p class="subtitulo">Seu pagamento foi confirmado com sucesso</p>

      <div class="confirmacao-box">
        <div class="confirmacao-text">PAGAMENTO CONFIRMADO</div>
        <div class="confirmacao-subtext">Seu bol√£o foi registrado neste dispositivo.</div>
      </div>

      <div class="info-pedido">
        <h3>Informa√ß√µes do Pedido</h3>

        <div class="info-row" id="rowNome" style="display:none;">
          <span class="label">Nome:</span>
          <span class="value" id="nomeCliente"></span>
        </div>

        <div class="info-row" id="rowCpf" style="display:none;">
          <span class="label">CPF:</span>
          <span class="value" id="cpfCliente"></span>
        </div>

        <div class="info-row">
          <span class="label">Data da Compra:</span>
          <span class="value" id="dataCompra"></span>
        </div>
      </div>

      <div style="margin-top: 14px; margin-bottom: 8px;">
        <button class="primary-button" id="verBolaoBtn" type="button">
          VER MEU BOL√ÉO (DEZENAS)
        </button>
      </div>

      <div class="mensagem-final">
        <strong>üìå Importante:</strong> as dezenas exibidas abaixo s√£o as dezenas salvas no seu navegador no momento da compra.
      </div>

      <div class="help-link">
        <a href="#" onclick="mostrarAjuda(); return false;">Precisa de ajuda?</a>
      </div>
    </div>
  </div>

  <!-- Modal do bol√£o -->
  <div class="bolao-modal-overlay" id="bolaoModalOverlay" aria-hidden="true">
    <div class="bolao-modal" role="dialog" aria-modal="true" aria-labelledby="bolaoModalTitle">
      <div class="bolao-modal-header">
        <div class="bolao-modal-title" id="bolaoModalTitle">SEU BOL√ÉO (DEZENAS)</div>
        <button class="bolao-modal-close" id="bolaoModalClose" type="button" aria-label="Fechar">√ó</button>
      </div>
      <div class="bolao-modal-body">
        <div class="bolao-meta" id="bolaoMeta"></div>
        <div class="bolao-grid" id="bolaoGrid"></div>
        <div class="bolao-empty" id="bolaoEmpty" style="display:none;">
          N√£o encontramos um bol√£o salvo neste dispositivo. Volte ao painel e finalize uma compra para registrar as dezenas.
        </div>
      </div>
    </div>
  </div>

  <script>
    'use strict';

    const Formatadores = {
      cpf(cpf) {
        if (!cpf) return '_________________';
        const cpfLimpo = String(cpf).replace(/[^0-9]/g, '');
        if (cpfLimpo.length !== 11) return '_________________';
        return cpfLimpo.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
      },
      dataHora(data) {
        try {
          const date = data ? (data instanceof Date ? data : new Date(data)) : new Date();
          if (isNaN(date.getTime())) throw new Error('data invalida');
          return date.toLocaleString('pt-BR', { day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit' });
        } catch (e) {
          return new Date().toLocaleString('pt-BR', { day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit' });
        }
      }
    };

    const StorageManager = {
      get(chave, fallback = '') {
        try { return localStorage.getItem(chave) || fallback; }
        catch (e) { return fallback; }
      },
      getJSON(chave, fallback = null) {
        try {
          const raw = localStorage.getItem(chave);
          if (!raw) return fallback;
          return JSON.parse(raw);
        } catch (e) {
          return fallback;
        }
      }
    };

    function carregarDados() {
      const dadosUsuario = StorageManager.getJSON('dadosUsuario', {}) || {};
      const nome = String(dadosUsuario.nome || StorageManager.get('nome', '') || '').substring(0, 120);
      const cpf = String(dadosUsuario.cpf || StorageManager.get('cpf', '') || StorageManager.get('cpfUsuario', '') || '');

      const rowNome = document.getElementById('rowNome');
      const rowCpf = document.getElementById('rowCpf');

      if (nome) {
        document.getElementById('nomeCliente').textContent = nome;
        rowNome.style.display = 'flex';
      } else {
        rowNome.style.display = 'none';
      }

      if (cpf) {
        document.getElementById('cpfCliente').textContent = Formatadores.cpf(cpf);
        rowCpf.style.display = 'flex';
      } else {
        rowCpf.style.display = 'none';
      }

      document.getElementById('dataCompra').textContent = Formatadores.dataHora(new Date());
    }

    function mostrarAjuda() {
      alert('Se precisar, fale com o suporte do vendedor/organizador respons√°vel pela sua compra.');
    }

    function safeText(s) {
      return String(s || '').replace(/[<>\"']/g, '').substring(0, 200);
    }

    /* ==========================================================
      VER MEU BOL√ÉO
      Compat√≠vel com:
        - ultimoBolaoComprado (novo)
        - ultimaCompraBolao (antigo/fallback)
        - boloesComprados (hist√≥rico)
      Tamb√©m aceita ?bolao=ID pela URL
    ========================================================== */
    function getBolaoPreferencial() {
      const qp = new URLSearchParams(window.location.search);
      const bolaoParam = qp.get('bolao');

      const ultimoNovo = StorageManager.getJSON('ultimoBolaoComprado', null);
      if (ultimoNovo && Array.isArray(ultimoNovo.dezenas) && ultimoNovo.dezenas.length) {
        if (!bolaoParam || String(ultimoNovo.id) === String(bolaoParam)) return ultimoNovo;
      }

      const historico = StorageManager.getJSON('boloesComprados', []) || [];
      if (historico.length) {
        if (bolaoParam) {
          const found = historico.find(b => String(b.id) === String(bolaoParam));
          if (found && Array.isArray(found.dezenas) && found.dezenas.length) return found;
        }
        const last = historico[historico.length - 1];
        if (last && Array.isArray(last.dezenas) && last.dezenas.length) return last;
      }

      const fallback = StorageManager.getJSON('ultimaCompraBolao', null);
      if (fallback && Array.isArray(fallback.dezenas) && fallback.dezenas.length) return fallback;

      return null;
    }

    function abrirModalBolao() {
      const overlay = document.getElementById('bolaoModalOverlay');
      const closeBtn = document.getElementById('bolaoModalClose');
      const grid = document.getElementById('bolaoGrid');
      const meta = document.getElementById('bolaoMeta');
      const empty = document.getElementById('bolaoEmpty');

      grid.innerHTML = '';
      meta.innerHTML = '';
      empty.style.display = 'none';

      const bolao = getBolaoPreferencial();

      if (!bolao || !Array.isArray(bolao.dezenas) || bolao.dezenas.length === 0) {
        empty.style.display = 'block';
      } else {
        const id = safeText(bolao.id || '‚Äî');
        const qtd = bolao.dezenas.length;
        const ts = bolao.ts ? new Date(bolao.ts) : null;

        const meta1 = document.createElement('div');
        meta1.innerHTML = `<strong>Bol√£o:</strong> <span>${id}</span>`;

        const meta2 = document.createElement('div');
        meta2.innerHTML = `<strong>Dezenas:</strong> <span>${qtd}</span>`;

        const meta3 = document.createElement('div');
        meta3.innerHTML = `<strong>Registro:</strong> <span>${ts ? ts.toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'}) : '‚Äî'}</span>`;

        meta.appendChild(meta1);
        meta.appendChild(meta2);
        meta.appendChild(meta3);

        bolao.dezenas.forEach(n => {
          const el = document.createElement('div');
          el.className = 'bolao-num';
          el.textContent = String(n).padStart(2,'0');
          grid.appendChild(el);
        });
      }

      overlay.style.display = 'flex';
      overlay.setAttribute('aria-hidden', 'false');

      const close = () => {
        overlay.style.display = 'none';
        overlay.setAttribute('aria-hidden', 'true');
      };

      overlay.onclick = (e) => { if (e.target === overlay) close(); };
      closeBtn.onclick = close;

      document.addEventListener('keydown', function escHandler(e) {
        if (e.key === 'Escape') {
          close();
          document.removeEventListener('keydown', escHandler);
        }
      });
    }

    function configurarBotaoVerBolao() {
      const btn = document.getElementById('verBolaoBtn');
      if (!btn) return;

      // Se n√£o existir bol√£o salvo, desabilita e muda texto
      const bolao = getBolaoPreferencial();
      if (!bolao || !Array.isArray(bolao.dezenas) || bolao.dezenas.length === 0) {
        btn.disabled = true;
        btn.textContent = 'NENHUM BOL√ÉO ENCONTRADO';
        return;
      }

      btn.addEventListener('click', abrirModalBolao);
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function () {
        carregarDados();
        configurarBotaoVerBolao();
      });
    } else {
      carregarDados();
      configurarBotaoVerBolao();
    }
  </script>
</body>
</html>
